<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Arkibo Arcade</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root{
      --cream: #fffdf2;
      --green-1: #2e7d32;
      --green-2: #81c784;
      --accent: #cfe9d3;
      --card: #ffffff;
      --chess-light: #f0d9b5;
      --chess-dark: #b58863;
    }

    * {box-sizing: border-box;}
    html,body{height:100%; overflow: hidden;}
    body{
      margin:0;
      font-family:'Poppins',sans-serif;
      background: linear-gradient(180deg, #f8fff5 0%, #fffef8 100%);
      color: var(--green-1);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:10px;
      -webkit-font-smoothing:antialiased;
      text-transform:uppercase;
    }

    .app {
      width:100%;
      max-width:420px;
      background: var(--card);
      border-radius:18px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
      padding:16px;
      position:relative;
      height: 95vh;
      display: flex;
      flex-direction: column;
    }

    .logo {
      display:block;
      margin:8px auto 6px auto;
      width:80px;
      height:80px;
      object-fit:cover;
      border-radius:20px;
      border:4px solid rgba(255,255,255,0.6);
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }

    h1, h2 {
      font-weight:700;
      letter-spacing:1px;
      margin:6px 0 12px 0;
      font-size:18px;
      text-align:center;
    }

    .menu-buttons {
      display:flex;
      flex-direction:column;
      gap:10px;
      padding:6px 8px 18px 8px;
      overflow-y: auto;
    }

    .btn {
      border: none;
      background: linear-gradient(180deg, var(--green-2), #9ccc65);
      color: #053608;
      padding:14px;
      border-radius:12px;
      font-weight:700;
      font-size:14px;
      cursor:pointer;
      box-shadow: 0 6px 14px rgba(0,0,0,0.06);
      text-decoration: none;
      text-align: center;
    }
    .btn.ghost {
      background: transparent;
      border:2px solid var(--green-2);
      color: var(--green-1);
    }

    /* screens */
    .screen { display:none; flex-direction: column; height: 100%; width: 100%; overflow-y: auto; }
    .screen.active { display:flex; }

    .top-row {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      margin-bottom:8px;
    }

    .icon-large { width:60px; height:60px; border-radius:15px; }
    .icon-medium { width:40px; height:40px; border-radius:10px; }

    .small { font-size:11px; opacity:0.85; }

    /* Quiz layout */
    .quiz-card {
      background: var(--accent);
      border-radius:12px;
      padding:12px;
      margin-bottom:10px;
    }
    .question { font-size:13px; margin-bottom:8px; font-weight: 700; }
    .choices { display:flex; flex-direction:column; gap:8px; }
    .choice-btn {
      background:white;
      border-radius:10px;
      padding:10px;
      border:1px solid rgba(0,0,0,0.06);
      font-weight:600;
      cursor:pointer;
      font-size: 12px;
    }
    input[type="text"].answer-typed {
      width:100%;
      padding:10px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,0.08);
      font-weight:600;
    }

    .controls { display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; justify-content: center; }
    .small-btn {
      padding:8px 10px;
      border-radius:10px;
      border:none;
      background:var(--green-2);
      color:#053608;
      font-weight:700;
      cursor:pointer;
      font-size: 11px;
    }

    /* Chess Fixed Dimensions */
    #chess-board-container {
      width: 100%;
      display: flex;
      justify-content: center;
      margin: 10px 0;
    }
    #chess-board {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      width: 320px; /* Fixed for mobile stability */
      height: 320px;
      border: 4px solid var(--green-1);
      touch-action: none;
    }
    .chess-square {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      cursor: pointer;
      user-select: none;
    }
    .chess-square.light { background: var(--chess-light); }
    .chess-square.dark { background: var(--chess-dark); }
    .chess-square.selected { background: #f7e365 !important; }

    /* Tic Tac Toe */
    .ttt-board {
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:8px;
      width: 240px;
      margin:8px auto;
    }
    .ttt-cell {
      background: var(--accent);
      height:70px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:32px;
      font-weight:800;
      border-radius:10px;
    }

    /* Match-Kibo */
    .match-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 5px;
    }
    .match-card {
      height: 60px;
      background: var(--green-2);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      color: transparent;
    }
    .match-card.flipped { background: var(--accent); color: var(--green-1); }
    .match-card.matched { background: #eee; color: #ccc; }

    #clicker-area {
      width: 100%;
      height: 250px;
      background: #f0fdf4;
      border: 2px dashed var(--green-2);
      position: relative;
      border-radius: 12px;
      overflow: hidden;
    }
    #target-star { position: absolute; font-size: 30px; cursor: pointer; }

    .lb-table { width: 100%; border-collapse: collapse; font-size: 12px; }
    .lb-table th { background: var(--green-1); color: white; padding: 6px; }
    .lb-table td { padding: 6px; border-bottom: 1px solid #eee; text-align: center; }
    .my-row { background: #fffde7; font-weight: bold; }

    .word-display { font-size:22px; font-weight:800; margin:10px 0; color: var(--green-1); }
    .center { text-align:center; }
    .sub-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
  </style>
</head>
<body>

  <div class="app" id="app">
    
    <div id="auth-screen" class="screen active">
      <img class="logo" src="https://i.imgur.com/gguUeAe.png" alt="Logo" />
      <h1>IDENTIFY YOURSELF</h1>
      <div class="menu-buttons">
        <input type="text" id="username-input" class="answer-typed" placeholder="Username..." style="text-align:center">
        <button class="btn" id="save-user">START ADVENTURE</button>
      </div>
    </div>

    <div id="menu" class="screen">
      <img class="logo" src="https://i.imgur.com/gguUeAe.png" alt="Logo" />
      <h1>ARKIBO ARCADE</h1>
      <div class="center small" style="margin-bottom:15px;">
        PLAYER: <span id="display-name">...</span> | STARS: <span id="display-points">0</span>
      </div>
      <div class="menu-buttons">
        <button class="btn" id="to-chess-kibo">KIBO-CHESS</button>
        <button class="btn" id="to-quiz">QUIZME</button>
        <button class="btn" id="to-ttt">TIC-TAC-KIBO</button>
        <button class="btn" id="to-bone">KIBO BONE RUSH</button>
        <button class="btn" id="to-match">MATCH-KIBO</button>
        <button class="btn" id="to-clicker">STAR CLICKER</button>
        <button class="btn ghost" id="to-lb">LEADERBOARD</button>
        <button class="btn ghost" id="logout-btn" style="border-color: #ff8a80; color: #d32f2f;">LOGOUT</button>
      </div>
    </div>

    <div id="chess-kibo-screen" class="screen">
        <div class="top-row">
            <h2 style="margin:0">CHESS</h2>
            <button class="small-btn ghost" onclick="goHome()">MENU</button>
        </div>
        <div class="quiz-card">
            <div class="center small" id="chess-kibo-status">WHITE'S TURN</div>
            <div id="chess-board-container"><div id="chess-board"></div></div>
            <div class="center" style="margin-top:10px;">
                <button class="small-btn" id="chess-kibo-reset">RESET</button>
            </div>
        </div>
    </div>

    <div id="quiz-select-screen" class="screen">
        <div class="top-row">
            <h2>SELECT SUBJECT</h2>
            <button class="small-btn ghost" onclick="goHome()">BACK</button>
        </div>
        <div class="sub-grid">
            <button class="btn" onclick="startQuiz('English')">English</button>
            <button class="btn" onclick="startQuiz('Math')">Math</button>
            <button class="btn" onclick="startQuiz('History')">History</button>
            <button class="btn" onclick="startQuiz('Science')">Science</button>
            <button class="btn" onclick="startQuiz('General')">General</button>
        </div>
    </div>

    <div id="quiz-screen" class="screen">
      <div class="top-row">
        <h2 id="quiz-sub-title">QUIZ</h2>
        <div style="text-align:right;">
          <div class="small">SCORE: <span id="quiz-score">0</span></div>
          <div class="small">TIME: <span id="quiz-timer">00:00</span></div>
        </div>
      </div>
      <div class="quiz-card">
        <div class="question" id="quiz-question">...</div>
        <div id="quiz-interaction"></div>
        <div class="controls">
          <button class="small-btn" id="quiz-next">NEXT</button>
          <button class="small-btn ghost" onclick="goHome()">QUIT</button>
        </div>
      </div>
    </div>

    <div id="ttt-screen" class="screen">
      <div class="top-row">
        <h2>TIC-TAC-KIBO</h2>
        <button class="small-btn ghost" onclick="goHome()">MENU</button>
      </div>
      <div class="ttt-board" id="ttt-board"></div>
      <div class="center">
        <div class="small" id="ttt-status">Turn: X</div>
        <button class="small-btn" id="reset-ttt" style="margin-top:10px">RESET</button>
      </div>
    </div>

    <div id="bone-screen" class="screen">
      <div class="top-row">
        <h2>BONE RUSH</h2>
        <button class="small-btn ghost" onclick="goHome()">MENU</button>
      </div>
      <div class="quiz-card center">
        <div class="word-display" id="bone-word">READY?</div>
        <input type="text" id="bone-input" class="answer-typed" placeholder="Type here..." autocomplete="off" />
        <div style="margin-top:10px;">
          <button class="small-btn" id="bone-start">START</button>
        </div>
        <div class="controls">
          <div class="small">BONES: <span id="bone-score">0</span></div>
          <div class="small">TIME: <span id="bone-timer">60</span></div>
        </div>
      </div>
    </div>

    <div id="match-screen" class="screen">
        <div class="top-row">
            <h2>MATCH-KIBO</h2>
            <button class="small-btn ghost" onclick="goHome()">MENU</button>
        </div>
        <div class="quiz-card">
            <div class="center small">TIME: <span id="match-timer">120</span>s | MATCHES: <span id="match-count">0</span>/10</div>
            <div class="match-grid" id="match-grid"></div>
            <div class="center" style="margin-top:15px;">
                <button class="small-btn" id="match-start">START</button>
            </div>
        </div>
    </div>

    <div id="clicker-screen" class="screen">
        <div class="top-row">
            <h2>STAR CLICKER</h2>
            <button class="small-btn ghost" onclick="goHome()">MENU</button>
        </div>
        <div class="quiz-card">
            <div class="center small">TIME: <span id="clicker-timer">30</span>s | SCORE: <span id="clicker-score">0</span></div>
            <div id="clicker-area">
                <div id="target-star" style="display:none;">‚≠ê</div>
            </div>
            <div class="center" style="margin-top:15px;">
                <button class="small-btn" id="clicker-start">START</button>
            </div>
        </div>
    </div>

    <div id="lb-screen" class="screen">
        <div class="top-row">
            <h2>RANKINGS</h2>
            <button class="small-btn ghost" onclick="goHome()">BACK</button>
        </div>
        <table class="lb-table">
            <thead><tr><th>RANK</th><th>USER</th><th>STARS</th></tr></thead>
            <tbody id="lb-body"></tbody>
        </table>
    </div>

  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getDatabase, ref, set, get, update, onValue } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDEwADNCb_uNyeFkIgi5g03Pkqv3uXNpoQ",
        authDomain: "arkibo-arcade.firebaseapp.com",
        databaseURL: "https://arkibo-arcade-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "arkibo-arcade",
        storageBucket: "arkibo-arcade.firebasestorage.app",
        messagingSenderId: "647271681508",
        appId: "1:647271681508:web:5b51c957aaec76e7668bf1"
    };

    const fbApp = initializeApp(firebaseConfig);
    const db = getDatabase(fbApp);

    let currentUser = null;
    let userPoints = 0;

    /* --- HELPERS --- */
    window.goHome = () => {
        clearIntervals();
        showScreen('menu');
    }

    function clearIntervals() {
        clearInterval(qTimer);
        clearInterval(bTimer);
        clearInterval(matchTimer);
        clearInterval(clickTimer);
    }

    function cleanFirebasePath(str) { return str.replace(/[.#$[\]{}:"]/g, "_"); }

    /* --- AUTH --- */
    const nameInput = document.getElementById('username-input');
    const saveBtn = document.getElementById('save-user');

    saveBtn.onclick = async () => {
        const val = nameInput.value.trim();
        if (val.length < 3) return alert("Username too short!");
        currentUser = cleanFirebasePath(val);
        localStorage.setItem('arkibo_user', currentUser);
        
        const userRef = ref(db, 'users/' + currentUser);
        const snapshot = await get(userRef);
        if (!snapshot.exists()) {
            await set(userRef, { username: currentUser, points: 0 });
        }
        loadUserData();
        showScreen('menu');
    };

    document.getElementById('logout-btn').onclick = () => {
        localStorage.removeItem('arkibo_user');
        location.reload();
    };

    function loadUserData() {
        if (!currentUser) return;
        document.getElementById('display-name').textContent = currentUser;
        onValue(ref(db, 'users/' + currentUser), (snapshot) => {
            const data = snapshot.val();
            if (data) {
                userPoints = data.points || 0;
                document.getElementById('display-points').textContent = userPoints;
            }
        });
    }

    async function addPoints(amount) {
        if (amount <= 0 || !currentUser) return;
        await update(ref(db, 'users/' + currentUser), { points: userPoints + amount });
    }

    /* --- NAVIGATION --- */
    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'lb-screen') loadLeaderboard();
        if(id === 'chess-kibo-screen') initChess();
    }

    document.getElementById('to-quiz').onclick = () => showScreen('quiz-select-screen');
    document.getElementById('to-ttt').onclick = () => showScreen('ttt-screen');
    document.getElementById('to-bone').onclick = () => showScreen('bone-screen');
    document.getElementById('to-match').onclick = () => showScreen('match-screen');
    document.getElementById('to-clicker').onclick = () => showScreen('clicker-screen');
    document.getElementById('to-chess-kibo').onclick = () => showScreen('chess-kibo-screen');
    document.getElementById('to-lb').onclick = () => showScreen('lb-screen');

    /* --- CHESS --- */
    let game = new Chess();
    let selectedSquare = null;
    const pieceMap = { 'p': '‚ôü', 'r': '‚ôú', 'n': '‚ôû', 'b': '‚ôù', 'q': '‚ôõ', 'k': '‚ôö', 'P': '‚ôô', 'R': '‚ôñ', 'N': '‚ôò', 'B': '‚ôó', 'Q': '‚ôï', 'K': '‚ôî' };

    function initChess() {
        game = new Chess();
        selectedSquare = null;
        renderBoard();
        updateStatus();
    }

    function renderBoard() {
        const boardEl = document.getElementById('chess-board');
        boardEl.innerHTML = '';
        const board = game.board();
        for (let i = 0; i < 8; i++) {
            for (let j = 0; j < 8; j++) {
                const sq = document.createElement('div');
                const pos = String.fromCharCode(97 + j) + (8 - i);
                sq.className = `chess-square ${(i + j) % 2 === 0 ? 'light' : 'dark'}`;
                const piece = board[i][j];
                if (piece) {
                    sq.textContent = pieceMap[piece.color === 'w' ? piece.type.toUpperCase() : piece.type];
                    sq.style.color = piece.color === 'w' ? '#fff' : '#000';
                }
                if (selectedSquare === pos) sq.classList.add('selected');
                sq.onclick = () => handleChessClick(pos);
                boardEl.appendChild(sq);
            }
        }
    }

    async function handleChessClick(pos) {
        if (game.game_over()) return;
        if (selectedSquare === pos) { selectedSquare = null; renderBoard(); return; }
        const move = game.move({ from: selectedSquare, to: pos, promotion: 'q' });
        if (move) {
            selectedSquare = null; renderBoard(); updateStatus();
            if (game.game_over()) {
                let reward = game.in_checkmate() ? 50 : 25;
                alert("Game Over! Reward: " + reward + " Stars");
                await addPoints(reward);
                goHome();
            }
        } else {
            const p = game.get(pos);
            if (p && p.color === game.turn()) { selectedSquare = pos; renderBoard(); }
        }
    }

    function updateStatus() {
        const t = game.turn() === 'w' ? "WHITE" : "BLACK";
        document.getElementById('chess-kibo-status').textContent = game.in_check() ? `${t} IN CHECK!` : `${t}'S TURN`;
    }
    document.getElementById('chess-kibo-reset').onclick = initChess;

    /* --- QUIZ SYSTEM --- */
    const quizData = {
        English: [
            {q:"Synonym of 'Happy'?", a:"Joyful", c:["Sad","Joyful","Angry","Tired"]},
            {q:"Antonym of 'Hot'?", a:"Cold", c:["Warm","Cold","Burning","Dry"]},
            {q:"Who wrote 'Hamlet'?", a:"Shakespeare", c:["Dickens","Shakespeare","Twain","Austen"]},
            {q:"A person who writes books?", a:"Author", c:["Doctor","Author","Pilot","Baker"]},
            {q:"Plural of 'Child'?", a:"Children", c:["Childs","Childrens","Children","Kids"]},
            {q:"Past tense of 'Eat'?", a:"Ate", c:["Eaten","Ate","Eats","Eating"]},
            {q:"Meaning of 'Brevity'?", a:"Shortness", c:["Length","Shortness","Strength","Speed"]},
            {q:"Identify the Noun: 'Run fast Kibo'.", a:"Kibo", c:["Run","Fast","Kibo","None"]},
            {q:"A word that describes a verb?", a:"Adverb", c:["Noun","Adjective","Adverb","Pronoun"]},
            {q:"What is a 'Stanza'?", a:"Poem section", c:["Music note","Poem section","Type of car","Food"]},
            {q:"Synonym of 'Large'?", a:"Huge", c:["Small","Huge","Tiny","Thin"]},
            {q:"Antonym of 'Fast'?", a:"Slow", c:["Quick","Rapid","Slow","Swift"]},
            {q:"Who is the creator of Sherlock Holmes?", a:"Conan Doyle", c:["Agatha Christie","Conan Doyle","Poe","King"]},
            {q:"'She ____ to school every day.'", a:"goes", c:["go","goes","going","gone"]},
            {q:"The 'Subject' of a sentence is...?", a:"Who/What", c:["The action","Who/What","The place","The time"]},
            {q:"What is an 'Anagram'?", a:"Rearranged letters", c:["A synonym","A rhyme","Rearranged letters","A joke"]},
            {q:"Synonym of 'Begin'?", a:"Start", c:["End","Start","Pause","Stop"]},
            {q:"A story with talking animals?", a:"Fable", c:["Essay","Fable","News","Manual"]},
            {q:"Correct spelling?", a:"Necessary", c:["Necesary","Necessary","Neccessary","Nicesary"]},
            {q:"Opposite of 'Success'?", a:"Failure", c:["Win","Goal","Failure","Luck"]},
            {q:"'To cry wolf' means?", a:"False alarm", c:["Hunt","False alarm","Be brave","Eat meat"]},
            {q:"Identify the Adjective: 'Blue sky'.", a:"Blue", c:["Blue","Sky","The","Is"]},
            {q:"A book of maps is an...?", a:"Atlas", c:["Atlas","Dictionary","Novel","Diary"]},
            {q:"Smallest unit of sound?", a:"Phoneme", c:["Word","Phoneme","Letter","Sentence"]},
            {q:"A word that sounds like another?", a:"Homophone", c:["Synonym","Homophone","Antonym","Verb"]}
        ],
        Math: [
            {q:"5 + 7?", a:"12", c:["11","12","13","14"]},
            {q:"12 x 3?", a:"36", c:["30","36","40","42"]},
            {q:"Square root of 64?", a:"8", c:["6","7","8","9"]},
            {q:"100 / 4?", a:"25", c:["20","25","30","35"]},
            {q:"15 - 8?", a:"7", c:["6","7","8","9"]},
            {q:"9 squared?", a:"81", c:["18","72","81","90"]},
            {q:"What is 10% of 200?", a:"20", c:["10","20","30","40"]},
            {q:"Value of Pi (2 decimals)?", a:"3.14", c:["3.12","3.14","3.16","3.18"]},
            {q:"Next in sequence: 2, 4, 6...?", a:"8", c:["7","8","9","10"]},
            {q:"How many sides in a Hexagon?", a:"6", c:["5","6","7","8"]},
            {q:"50 x 2 + 10?", a:"110", c:["100","110","120","60"]},
            {q:"Half of 90?", a:"45", c:["40","45","50","55"]},
            {q:"3 + 3 x 3?", a:"12", c:["18","12","9","15"]},
            {q:"1/4 as a decimal?", a:"0.25", c:["0.50","0.25","0.75","0.10"]},
            {q:"Seconds in 2 minutes?", a:"120", c:["60","100","120","140"]},
            {q:"10 x 10 x 0?", a:"0", c:["10","100","0","1"]},
            {q:"A right angle is ___ degrees?", a:"90", c:["45","90","180","360"]},
            {q:"Is 7 a prime number?", a:"Yes", c:["Yes","No","Maybe","Only on Tuesdays"]},
            {q:"8 + 8 / 2?", a:"12", c:["8","12","16","4"]},
            {q:"Roman numeral for 10?", a:"X", c:["V","X","L","C"]},
            {q:"Side of square with area 49?", a:"7", c:["6","7","8","9"]},
            {q:"13 + 27?", a:"40", c:["30","40","50","45"]},
            {q:"2 to the power of 3?", a:"8", c:["4","6","8","10"]},
            {q:"30 / 5 + 4?", a:"10", c:["10","9","11","6"]},
            {q:"0.5 + 0.5?", a:"1", c:["1","2","0.10","0.55"]}
        ],
        History: [
            {q:"First man on the moon?", a:"Neil Armstrong", c:["Buzz Aldrin","Neil Armstrong","Yuri Gagarin","Elon Musk"]},
            {q:"Who discovered America?", a:"Columbus", c:["Vespucci","Columbus","Cook","Magellan"]},
            {q:"Year WWI started?", a:"1914", c:["1912","1914","1939","1945"]},
            {q:"Ancient Egyptian kings?", a:"Pharaohs", c:["Knights","Pharaohs","Emperors","Czars"]},
            {q:"Country of the Samurai?", a:"Japan", c:["China","Japan","Korea","Thailand"]},
            {q:"Who was the 'Iron Lady'?", a:"Margaret Thatcher", c:["Queen Elizabeth","Margaret Thatcher","Angela Merkel","Diana"]},
            {q:"Year of the Titanic sink?", a:"1912", c:["1910","1912","1914","1920"]},
            {q:"Inventor of Lightbulb?", a:"Edison", c:["Tesla","Edison","Ford","Bell"]},
            {q:"Leader of Nazi Germany?", a:"Hitler", c:["Stalin","Mussolini","Hitler","Churchill"]},
            {q:"First President of USA?", a:"Washington", c:["Lincoln","Washington","Jefferson","Adams"]},
            {q:"Which empire built the Colosseum?", a:"Roman", c:["Greek","Roman","Persian","Aztec"]},
            {q:"Who wrote the US Declaration?", a:"Jefferson", c:["Washington","Jefferson","Franklin","Hamilton"]},
            {q:"City destroyed by Vesuvius?", a:"Pompeii", c:["Rome","Pompeii","Athens","Sparta"]},
            {q:"Where did Democracy start?", a:"Greece", c:["Rome","Greece","Egypt","France"]},
            {q:"The Great Wall is in...?", a:"China", c:["Japan","India","China","Mongolia"]},
            {q:"Who was the French Queen executed?", a:"Marie Antoinette", c:["Joan of Arc","Marie Antoinette","Catherine","Mary"]},
            {q:"Civil War: North vs ____?", a:"South", c:["East","West","South","Britain"]},
            {q:"Industrial Revolution started in?", a:"Britain", c:["USA","Germany","Britain","France"]},
            {q:"Who was 'The Maid of Orleans'?", a:"Joan of Arc", c:["Mary Magdalene","Joan of Arc","Queen Mary","Elizabeth"]},
            {q:"End of WWII year?", a:"1945", c:["1944","1945","1946","1950"]},
            {q:"Aztec Empire location?", a:"Mexico", c:["Peru","Brazil","Mexico","Chile"]},
            {q:"Who fought in the Crusades?", a:"Knights", c:["Pirates","Knights","Ninjas","Cowboys"]},
            {q:"The 'Black Death' was a...?", a:"Plague", c:["War","Plague","Storm","Famine"]},
            {q:"Apartheid ended in which country?", a:"South Africa", c:["USA","South Africa","India","Kenya"]},
            {q:"Who was the first female pilot?", a:"Amelia Earhart", c:["Rosa Parks","Amelia Earhart","Sally Ride","Marie Curie"]}
        ],
        Science: [
            {q:"Planet known as Red Planet?", a:"Mars", c:["Venus","Mars","Jupiter","Saturn"]},
            {q:"Gas humans breathe out?", a:"Carbon Dioxide", c:["Oxygen","Nitrogen","Carbon Dioxide","Helium"]},
            {q:"Hardest natural substance?", a:"Diamond", c:["Gold","Iron","Diamond","Steel"]},
            {q:"Study of living things?", a:"Biology", c:["Physics","Geology","Biology","Chemistry"]},
            {q:"Center of an atom?", a:"Nucleus", c:["Electron","Proton","Nucleus","Neutron"]},
            {q:"Largest organ in the body?", a:"Skin", c:["Liver","Heart","Skin","Lungs"]},
            {q:"Water freezes at ___ Celsius?", a:"0", c:["0","32","100","-1"]},
            {q:"Star at the center of Solar System?", a:"Sun", c:["Moon","Sun","Polaris","Mars"]},
            {q:"Force that keeps us on ground?", a:"Gravity", c:["Friction","Gravity","Magnetism","Speed"]},
            {q:"H2O is...?", a:"Water", c:["Salt","Acid","Water","Gas"]},
            {q:"How many legs does a spider have?", a:"8", c:["6","8","10","12"]},
            {q:"Which vitamin comes from Sun?", a:"D", c:["A","B","C","D"]},
            {q:"The 'Powerhouse' of the cell?", a:"Mitochondria", c:["Nucleus","Mitochondria","Ribosome","Wall"]},
            {q:"What do bees collect?", a:"Nectar", c:["Honey","Nectar","Water","Dust"]},
            {q:"Boiling point of water (C)?", a:"100", c:["90","100","110","200"]},
            {q:"Closest planet to Sun?", a:"Mercury", c:["Venus","Earth","Mercury","Mars"]},
            {q:"Earth's natural satellite?", a:"Moon", c:["Sun","Moon","Titan","Europa"]},
            {q:"Gas used in balloons to float?", a:"Helium", c:["Oxygen","Helium","Nitrogen","Neon"]},
            {q:"What part of plant does photosynthesis?", a:"Leaf", c:["Root","Stem","Leaf","Flower"]},
            {q:"How many bones in adult body?", a:"206", c:["100","206","300","250"]},
            {q:"Color of Chlorophyll?", a:"Green", c:["Red","Blue","Green","Yellow"]},
            {q:"A scientist who studies rocks?", a:"Geologist", c:["Biologist","Geologist","Chemist","Physicist"]},
            {q:"Lightest element?", a:"Hydrogen", c:["Oxygen","Hydrogen","Helium","Carbon"]},
            {q:"Speed of Sound or Light faster?", a:"Light", c:["Sound","Light","Same","Neither"]},
            {q:"Earth's shape?", a:"Sphere", c:["Flat","Square","Sphere","Triangle"]}
        ],
        General: [
            {q:"Capital of France?", a:"Paris", c:["Lyon","Paris","Marseille","Nice"]},
            {q:"Currency of Japan?", a:"Yen", c:["Dollar","Yuan","Yen","Euro"]},
            {q:"Largest Ocean?", a:"Pacific", c:["Atlantic","Indian","Pacific","Arctic"]},
            {q:"Primary colors: Red, Yellow, ____?", a:"Blue", c:["Green","Blue","Orange","Purple"]},
            {q:"Color of Emerald?", a:"Green", c:["Red","Blue","Green","Yellow"]},
            {q:"How many continents?", a:"7", c:["5","6","7","8"]},
            {q:"The Eiffel Tower is in...?", a:"Paris", c:["London","Paris","Berlin","Rome"]},
            {q:"Tallest animal?", a:"Giraffe", c:["Elephant","Giraffe","Lion","Whale"]},
            {q:"Fruit used to make wine?", a:"Grapes", c:["Apples","Grapes","Berries","Plums"]},
            {q:"Opposite of North?", a:"South", c:["East","West","South","North-West"]},
            {q:"Standard piano keys?", a:"88", c:["76","88","92","100"]},
            {q:"Who painted Mona Lisa?", a:"Da Vinci", c:["Picasso","Da Vinci","Van Gogh","Dali"]},
            {q:"Olympic Games frequency?", a:"4 years", c:["2 years","4 years","5 years","1 year"]},
            {q:"Baby cat name?", a:"Kitten", c:["Puppy","Kitten","Cub","Calf"]},
            {q:"Language of Brazil?", a:"Portuguese", c:["Spanish","Portuguese","French","English"]},
            {q:"Country of the Taj Mahal?", a:"India", c:["Pakistan","India","China","Iran"]},
            {q:"Biggest planet?", a:"Jupiter", c:["Mars","Saturn","Jupiter","Earth"]},
            {q:"Rainbow colors count?", a:"7", c:["5","6","7","8"]},
            {q:"Which month has 28 days?", a:"February", c:["January","February","March","All of them"]},
            {q:"A 'Baker's Dozen' is how many?", a:"13", c:["12","13","14","15"]},
            {q:"The Statute of Liberty was a gift from?", a:"France", c:["UK","Germany","France","Italy"]},
            {q:"Musical with a phantom?", a:"Phantom of the Opera", c:["Cats","Phantom of the Opera","Hamilton","Wicked"]},
            {q:"Vatican City is inside which city?", a:"Rome", c:["Paris","Rome","Madrid","Athens"]},
            {q:"King of Pop?", a:"Michael Jackson", c:["Elvis","Michael Jackson","Prince","Bowie"]},
            {q:"Smallest country?", a:"Vatican City", c:["Monaco","Vatican City","Malta","Iceland"]}
        ]
    };

    let qCurrentSub = '', qIndex = 0, qScore = 0, qTimer, qTimeLeft = 60;

    window.startQuiz = (subject) => {
        qCurrentSub = subject;
        qIndex = 0; qScore = 0; qTimeLeft = 120;
        document.getElementById('quiz-sub-title').textContent = subject;
        showScreen('quiz-screen');
        renderQuestion();
        qTimer = setInterval(() => {
            qTimeLeft--;
            let m = Math.floor(qTimeLeft/60), s = qTimeLeft%60;
            document.getElementById('quiz-timer').textContent = `${m}:${s<10?'0':''}${s}`;
            if(qTimeLeft <= 0) quizEnd();
        }, 1000);
    };

    function renderQuestion() {
        const q = quizData[qCurrentSub][qIndex];
        document.getElementById('quiz-question').textContent = q.q;
        document.getElementById('quiz-score').textContent = qScore;
        const container = document.getElementById('quiz-interaction');
        container.innerHTML = '';
        const box = document.createElement('div');
        box.className = 'choices';
        q.c.forEach(choice => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.textContent = choice;
            btn.onclick = () => {
                if(choice === q.a) qScore++;
                qIndex++;
                if(qIndex < 25) renderQuestion(); else quizEnd();
            };
            box.appendChild(btn);
        });
        container.appendChild(box);
    }

    async function quizEnd() {
        clearInterval(qTimer);
        alert(`Quiz Finished! Score: ${qScore}. Reward: ${qScore * 2} Stars.`);
        await addPoints(qScore * 2);
        goHome();
    }

    /* --- BONE RUSH (150 WORDS) --- */
    const boneWords = [
        "APPLE","BANANA","CHERRY","DRAGON","EAGLE","FOREST","GHOST","HUNTER","ISLAND","JUNGLE","KIBO","LEMON","MOUNTAIN","NIGHT","OCEAN","PIZZA","QUEEN","RIVER","STORM","TIGER",
        "UNDER","VALLEY","WITCH","XRAY","YACHT","ZEBRA","ARCADIA","BRAVERY","CRYSTAL","DESTINY","ENERGY","FLOWER","GARDEN","HARBOR","INDIGO","JOURNEY","KNIGHT","LANTERN","MIRROR","NEBULA",
        "ORBIT","PIRATE","QUARTZ","ROCKET","SILVER","TEMPLE","UTOPIA","VORTEX","WIZARD","XENON","YELLOW","ZENITH","ANCIENT","BLOSSOM","CANYON","DESERT","EMERALD","FALCON","GLACIER","HORIZON",
        "ICEBERG","JAVELIN","KINDLE","LAGOON","MAGMA","NOMAD","OASIS","PHANTOM","QUIVER","RADIANT","SPHERE","THUNDER","UMBRA","VELVET","WHISPER","XYLOPHONE","YONDER","ZEPHYR","ALGORITHM","BLIZZARD",
        "CELESTIAL","DIAMOND","ECLIPSE","FIREWORKS","GALAXY","HOLOGRAM","INFINITY","JUPITER","KINETIC","LABYRINTH","MYSTERY","NEPTUNE","OVERLORD","PARADOX","QUANTUM","RENAISSANCE","SPECTRUM","TRIUMPH","UNIVERSE","VELOCITY",
        "WILDERNESS","XENOPHOBE","YESTERDAY","ZODIAC","ABANDON","BARRICADE","CARNIVAL","DYNAMITE","ETERNITY","FEATHER","GRAVITY","HARMONY","ILLUSION","JUSTICE","KINGDOM","LIBERTY","MAJESTY","NIRVANA","OPULENCE","PANDORA",
        "QUEST","REBELLION","SERENITY","TREASURE","UPRISING","VICTORY","WARRIOR","XENOPHILE","YOUTH","ZEALOT","ASTRONAUT","BIOSPHERE","CHRONICLE","DIMENSION","EXPLORER","FRAGMENT","GUARDIAN","HERITAGE","ISOLATION","JUDGMENT",
        "KNOWLEDGE","LEGACY","METEOR","NOSTALGIA","OBSIDIAN","PROPHESY","QUARANTINE","REFLECTION","SURVIVOR","TWILIGHT"
    ];

    let bScore = 0, bTime = 60, bTimer, bActive = false;
    document.getElementById('bone-start').onclick = () => {
        if(bActive) return;
        bActive = true; bScore = 0; bTime = 60;
        document.getElementById('bone-score').textContent = "0";
        nextBoneWord();
        bTimer = setInterval(() => {
            bTime--;
            document.getElementById('bone-timer').textContent = bTime;
            if(bTime <= 0) {
                clearInterval(bTimer); bActive = false;
                addPoints(bScore); alert("Time's Up! Earned " + bScore + " Stars.");
                goHome();
            }
        }, 1000);
    };

    function nextBoneWord() {
        document.getElementById('bone-word').textContent = boneWords[Math.floor(Math.random()*boneWords.length)];
        document.getElementById('bone-input').value = '';
        document.getElementById('bone-input').focus();
    }

    document.getElementById('bone-input').oninput = (e) => {
        if(!bActive) return;
        if(e.target.value.toUpperCase() === document.getElementById('bone-word').textContent) {
            bScore++; document.getElementById('bone-score').textContent = bScore;
            nextBoneWord();
        }
    };

    /* --- MATCH-KIBO --- */
    let matchIcons = ['üçé','üçé','‚≠ê','‚≠ê','üéÆ','üéÆ','üöÄ','üöÄ','üî•','üî•','üíé','üíé','üëª','üëª','üçÄ','üçÄ','üçÑ','üçÑ','üåç','üåç'];
    let flipped = [], matchCount = 0, matchTime = 120, matchTimer, matchActive = false;

    document.getElementById('match-start').onclick = () => {
        if(matchActive) return;
        matchActive = true; matchTime = 120; matchCount = 0;
        initMatchGrid();
        matchTimer = setInterval(() => {
            matchTime--; document.getElementById('match-timer').textContent = matchTime;
            if(matchTime <= 0) { clearInterval(matchTimer); matchActive = false; alert("Game Over!"); goHome(); }
        }, 1000);
    };

    function initMatchGrid() {
        const grid = document.getElementById('match-grid'); grid.innerHTML = '';
        matchIcons.sort(() => Math.random() - 0.5);
        matchIcons.forEach(icon => {
            const card = document.createElement('div');
            card.className = 'match-card'; card.textContent = icon;
            card.onclick = () => {
                if(!matchActive || flipped.length >= 2 || card.classList.contains('flipped')) return;
                card.classList.add('flipped'); flipped.push(card);
                if(flipped.length === 2) {
                    if(flipped[0].textContent === flipped[1].textContent) {
                        flipped.forEach(c => c.classList.add('matched')); flipped = [];
                        matchCount++; document.getElementById('match-count').textContent = matchCount;
                        if(matchCount === 10) { addPoints(20); alert("Cleared! +20 Stars"); goHome(); }
                    } else {
                        setTimeout(() => { flipped.forEach(c => c.classList.remove('flipped')); flipped = []; }, 600);
                    }
                }
            };
            grid.appendChild(card);
        });
    }

    /* --- STAR CLICKER --- */
    let clickScore = 0, clickTime = 30, clickTimer, clickActive = false;
    document.getElementById('clicker-start').onclick = () => {
        if(clickActive) return;
        clickActive = true; clickScore = 0; clickTime = 30;
        document.getElementById('target-star').style.display = 'block';
        moveStar();
        clickTimer = setInterval(() => {
            clickTime--; document.getElementById('clicker-timer').textContent = clickTime;
            if(clickTime <= 0) {
                clearInterval(clickTimer); clickActive = false;
                document.getElementById('target-star').style.display = 'none';
                addPoints(clickScore); alert("Done! Earned " + clickScore + " Stars.");
                goHome();
            }
        }, 1000);
    };

    function moveStar() {
        const area = document.getElementById('clicker-area');
        const star = document.getElementById('target-star');
        star.style.left = Math.random() * (area.clientWidth - 40) + 'px';
        star.style.top = Math.random() * (area.clientHeight - 40) + 'px';
    }
    document.getElementById('target-star').onclick = () => { clickScore++; document.getElementById('clicker-score').textContent = clickScore; moveStar(); };

    /* --- TIC TAC TOE --- */
    let tttBoard = Array(9).fill(null), tttPlayer = 'X';
    function initTTT() {
        const grid = document.getElementById('ttt-board'); grid.innerHTML = '';
        tttBoard = Array(9).fill(null); tttPlayer = 'X';
        for (let i = 0; i < 9; i++) {
            const cell = document.createElement('div'); cell.className = 'ttt-cell';
            cell.onclick = () => {
                if(tttBoard[i]) return;
                tttBoard[i] = tttPlayer; cell.textContent = tttPlayer;
                if(checkTTT()) { alert(tttPlayer + " Wins!"); addPoints(10); initTTT(); }
                else if(!tttBoard.includes(null)) { alert("Draw!"); initTTT(); }
                else { tttPlayer = tttPlayer === 'X' ? 'O' : 'X'; document.getElementById('ttt-status').textContent = "Turn: " + tttPlayer; }
            };
            grid.appendChild(cell);
        }
    }
    function checkTTT() {
        const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
        return wins.some(c => tttBoard[c[0]] && tttBoard[c[0]] === tttBoard[c[1]] && tttBoard[c[0]] === tttBoard[c[2]]);
    }
    document.getElementById('reset-ttt').onclick = initTTT;
    initTTT();

    /* --- LEADERBOARD --- */
    function loadLeaderboard() {
        onValue(ref(db, 'users'), (snap) => {
            const data = snap.val();
            const list = Object.values(data || {}).sort((a,b) => (b.points||0) - (a.points||0));
            const tbody = document.getElementById('lb-body'); tbody.innerHTML = '';
            list.forEach((u, i) => {
                const tr = document.createElement('tr');
                if(u.username === currentUser) tr.className = 'my-row';
                tr.innerHTML = `<td>${i+1}</td><td>${u.username}</td><td>${u.points||0}</td>`;
                tbody.appendChild(tr);
            });
        });
    }

    /* --- INIT APP --- */
    let stored = localStorage.getItem('arkibo_user');
    if (stored) {
        currentUser = cleanFirebasePath(stored);
        loadUserData();
        showScreen('menu');
    }
  </script>
</body>
</html>
